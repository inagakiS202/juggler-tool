<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>„Ç∏„É£„Ç∞„É©„ÉºË®≠ÂÆöÂà§Âà•„ÉÑ„Éº„É´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --success-color: #51cf66;
            --warning-color: #ffd43b;
            --danger-color: #ff6b6b;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), #ee5a6f);
            color: white;
            padding: 20px 16px;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 22px;
            font-weight: 700;
        }

        main {
            flex: 1;
            padding: 16px;
        }

        footer {
            background-color: var(--card-bg);
            padding: 16px;
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .card h3 {
            font-size: 16px;
            margin: 20px 0 12px 0;
            color: var(--text-primary);
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: white;
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            flex: 1;
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #ee5a6f);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: var(--bg-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:active {
            transform: scale(0.98);
            background-color: var(--border-color);
        }

        .result-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-box {
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .setting-graph {
            margin: 16px 0;
        }

        .setting-bar {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .setting-label {
            width: 60px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .bar-container {
            flex: 1;
            height: 28px;
            background-color: var(--bg-color);
            border-radius: 14px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--success-color));
            border-radius: 14px;
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .bar-percentage {
            font-size: 12px;
            font-weight: 700;
            color: white;
        }

        .recommendation {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            margin-top: 16px;
        }

        .recommendation span {
            font-size: 24px;
            font-weight: 700;
        }

        .history-list {
            margin-top: 16px;
        }

        .history-item {
            background-color: var(--bg-color);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .history-date {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .history-delete {
            color: var(--danger-color);
            cursor: pointer;
            font-size: 12px;
        }

        .history-data {
            color: var(--text-primary);
            line-height: 1.4;
        }

        /* iPhone 13 mini specific optimizations */
        @media screen and (max-width: 375px) {
            header h1 {
                font-size: 20px;
            }

            .card {
                padding: 16px;
            }

            .result-summary {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .stat-box {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .stat-label {
                font-size: 14px;
                margin-bottom: 0;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;
                --card-bg: #2d2d2d;
                --text-primary: #f8f9fa;
                --text-secondary: #adb5bd;
                --border-color: #495057;
            }

            .input-field {
                background-color: #343a40;
                color: var(--text-primary);
            }

            .input-field:focus {
                background-color: #495057;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #resultSection {
            animation: fadeIn 0.4s ease;
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>üé∞ „Ç∏„É£„Ç∞„É©„ÉºË®≠ÂÆöÂà§Âà•</h1>
        </header>

        <main>
            <!-- Ê©üÁ®ÆÈÅ∏Êäû -->
            <section class="card">
                <h2>Ê©üÁ®ÆÈÅ∏Êäû</h2>
                <select id="machineType" class="input-field">
                    <option value="myJuggler5">„Éû„Ç§„Ç∏„É£„Ç∞„É©„ÉºV</option>
                    <option value="goGo5">„Ç¥„Éº„Ç¥„Éº„Ç∏„É£„Ç∞„É©„Éº3</option>
                    <option value="happy">„Éè„ÉÉ„Éî„Éº„Ç∏„É£„Ç∞„É©„ÉºV III</option>
                </select>
            </section>

            <!-- „Éá„Éº„ÇøÂÖ•Âäõ -->
            <section class="card">
                <h2>„Éá„Éº„ÇøÂÖ•Âäõ</h2>

                <div class="input-group">
                    <label for="totalGames">Á∑è„Ç≤„Éº„É†Êï∞</label>
                    <input type="number" id="totalGames" class="input-field" placeholder="0" min="0">
                </div>

                <div class="input-group">
                    <label for="bigCount">BIGÂõûÊï∞</label>
                    <input type="number" id="bigCount" class="input-field" placeholder="0" min="0">
                </div>

                <div class="input-group">
                    <label for="regCount">REGÂõûÊï∞</label>
                    <input type="number" id="regCount" class="input-field" placeholder="0" min="0">
                </div>

                <div class="input-group">
                    <label for="grapeCount">„Å∂„Å©„ÅÜÂõûÊï∞Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</label>
                    <input type="number" id="grapeCount" class="input-field" placeholder="„Ç´„Ç¶„É≥„Éà„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø" min="0">
                </div>

                <div class="input-group">
                    <label for="cherryCount">„ÉÅ„Çß„É™„ÉºÂõûÊï∞Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</label>
                    <input type="number" id="cherryCount" class="input-field" placeholder="„Ç´„Ç¶„É≥„Éà„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø" min="0">
                </div>
            </section>

            <!-- „Éú„Çø„É≥ -->
            <section class="button-group">
                <button id="calculateBtn" class="btn btn-primary">Ë®≠ÂÆö„ÇíÂà§Âà•</button>
                <button id="resetBtn" class="btn btn-secondary">„É™„Çª„ÉÉ„Éà</button>
            </section>

            <!-- ÁµêÊûúË°®Á§∫ -->
            <section id="resultSection" class="card" style="display: none;">
                <h2>Âà§Âà•ÁµêÊûú</h2>

                <div class="result-summary">
                    <div class="stat-box">
                        <div class="stat-label">„Éú„Éº„Éä„ÇπÂêàÁÆó</div>
                        <div class="stat-value" id="bonusRate">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">BIGÁ¢∫Áéá</div>
                        <div class="stat-value" id="bigRate">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">REGÁ¢∫Áéá</div>
                        <div class="stat-value" id="regRate">-</div>
                    </div>
                </div>

                <div id="grapeResult" class="stat-row" style="display: none;">
                    <span class="stat-label">„Å∂„Å©„ÅÜÁ¢∫Áéá:</span>
                    <span class="stat-value" id="grapeRate">-</span>
                </div>

                <div id="cherryResult" class="stat-row" style="display: none;">
                    <span class="stat-label">„ÉÅ„Çß„É™„ÉºÁ¢∫Áéá:</span>
                    <span class="stat-value" id="cherryRate">-</span>
                </div>

                <h3>Ë®≠ÂÆöÊé®Ê∏¨</h3>
                <div id="settingGraph" class="setting-graph"></div>

                <div class="recommendation">
                    <strong>Êé®Â•®Ë®≠ÂÆö:</strong> <span id="recommendedSetting">-</span>
                </div>
            </section>

            <!-- „Éá„Éº„ÇøÂ±•Ê≠¥ -->
            <section class="card">
                <h2>„Éá„Éº„ÇøÂ±•Ê≠¥</h2>
                <button id="saveDataBtn" class="btn btn-secondary">ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí‰øùÂ≠ò</button>
                <div id="historyList" class="history-list"></div>
            </section>
        </main>

        <footer>
            <p>‚Äª„Åì„ÅÆ„ÉÑ„Éº„É´„ÅØÂèÇËÄÉÊÉÖÂ†±„Åß„Åô„ÄÇÂÆüÈöõ„ÅÆË®≠ÂÆö„Çí‰øùË®º„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
        </footer>
    </div>

    <script>
        // „Ç∏„É£„Ç∞„É©„ÉºÊ©üÁ®Æ„Éá„Éº„Çø
        const machineData = {
            myJuggler5: {
                name: '„Éû„Ç§„Ç∏„É£„Ç∞„É©„ÉºV',
                settings: {
                    1: { big: 1/287.4, reg: 1/431.2, grape: 1/6.35, bonus: 1/172.5 },
                    2: { big: 1/282.5, reg: 1/364.1, grape: 1/6.30, bonus: 1/159.1 },
                    3: { big: 1/273.1, reg: 1/341.3, grape: 1/6.25, bonus: 1/151.7 },
                    4: { big: 1/264.3, reg: 1/292.6, grape: 1/6.23, bonus: 1/138.9 },
                    5: { big: 1/252.1, reg: 1/277.7, grape: 1/6.18, bonus: 1/132.1 },
                    6: { big: 1/240.9, reg: 1/240.9, grape: 1/6.07, bonus: 1/120.5 }
                }
            },
            goGo5: {
                name: '„Ç¥„Éº„Ç¥„Éº„Ç∏„É£„Ç∞„É©„Éº3',
                settings: {
                    1: { big: 1/276.2, reg: 1/399.6, grape: 1/6.35, bonus: 1/163.4 },
                    2: { big: 1/266.4, reg: 1/348.6, grape: 1/6.30, bonus: 1/151.0 },
                    3: { big: 1/256.0, reg: 1/315.1, grape: 1/6.25, bonus: 1/141.3 },
                    4: { big: 1/252.1, reg: 1/292.6, grape: 1/6.23, bonus: 1/135.4 },
                    5: { big: 1/241.0, reg: 1/273.1, grape: 1/6.18, bonus: 1/128.0 },
                    6: { big: 1/229.1, reg: 1/229.1, grape: 1/6.07, bonus: 1/114.6 }
                }
            },
            happy: {
                name: '„Éè„ÉÉ„Éî„Éº„Ç∏„É£„Ç∞„É©„ÉºV III',
                settings: {
                    1: { big: 1/303.4, reg: 1/528.5, grape: 1/6.49, bonus: 1/192.9 },
                    2: { big: 1/297.9, reg: 1/442.8, grape: 1/6.35, bonus: 1/178.0 },
                    3: { big: 1/280.1, reg: 1/390.1, grape: 1/6.25, bonus: 1/163.2 },
                    4: { big: 1/268.6, reg: 1/334.4, grape: 1/6.18, bonus: 1/149.2 },
                    5: { big: 1/252.1, reg: 1/287.4, grape: 1/6.07, bonus: 1/134.3 },
                    6: { big: 1/240.9, reg: 1/240.9, grape: 1/6.00, bonus: 1/120.5 }
                }
            }
        };

        // DOMË¶ÅÁ¥†
        const elements = {
            machineType: document.getElementById('machineType'),
            totalGames: document.getElementById('totalGames'),
            bigCount: document.getElementById('bigCount'),
            regCount: document.getElementById('regCount'),
            grapeCount: document.getElementById('grapeCount'),
            cherryCount: document.getElementById('cherryCount'),
            calculateBtn: document.getElementById('calculateBtn'),
            resetBtn: document.getElementById('resetBtn'),
            saveDataBtn: document.getElementById('saveDataBtn'),
            resultSection: document.getElementById('resultSection'),
            bonusRate: document.getElementById('bonusRate'),
            bigRate: document.getElementById('bigRate'),
            regRate: document.getElementById('regRate'),
            grapeRate: document.getElementById('grapeRate'),
            cherryRate: document.getElementById('cherryRate'),
            grapeResult: document.getElementById('grapeResult'),
            cherryResult: document.getElementById('cherryResult'),
            settingGraph: document.getElementById('settingGraph'),
            recommendedSetting: document.getElementById('recommendedSetting'),
            historyList: document.getElementById('historyList')
        };

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        elements.calculateBtn.addEventListener('click', calculateSettings);
        elements.resetBtn.addEventListener('click', resetForm);
        elements.saveDataBtn.addEventListener('click', saveToHistory);

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÂ±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø
        loadHistory();

        // Ë®≠ÂÆöÂà§Âà•Ë®àÁÆó
        function calculateSettings() {
            const totalGames = parseInt(elements.totalGames.value) || 0;
            const bigCount = parseInt(elements.bigCount.value) || 0;
            const regCount = parseInt(elements.regCount.value) || 0;
            const grapeCount = parseInt(elements.grapeCount.value) || 0;
            const cherryCount = parseInt(elements.cherryCount.value) || 0;

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (totalGames === 0 || (bigCount === 0 && regCount === 0)) {
                alert('Á∑è„Ç≤„Éº„É†Êï∞„Å®„Éú„Éº„Éä„ÇπÂõûÊï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // ÂÆüÈöõ„ÅÆÁ¢∫Áéá„ÇíË®àÁÆó
            const actualBigRate = totalGames / bigCount;
            const actualRegRate = totalGames / regCount;
            const actualBonusRate = totalGames / (bigCount + regCount);
            const actualGrapeRate = grapeCount > 0 ? totalGames / grapeCount : null;

            // Á¢∫Áéá„ÇíË°®Á§∫
            elements.bonusRate.textContent = `1/${actualBonusRate.toFixed(1)}`;
            elements.bigRate.textContent = `1/${actualBigRate.toFixed(1)}`;
            elements.regRate.textContent = `1/${actualRegRate.toFixed(1)}`;

            if (actualGrapeRate) {
                elements.grapeRate.textContent = `1/${actualGrapeRate.toFixed(2)}`;
                elements.grapeResult.style.display = 'flex';
            } else {
                elements.grapeResult.style.display = 'none';
            }

            if (cherryCount > 0) {
                const actualCherryRate = totalGames / cherryCount;
                elements.cherryRate.textContent = `1/${actualCherryRate.toFixed(2)}`;
                elements.cherryResult.style.display = 'flex';
            } else {
                elements.cherryResult.style.display = 'none';
            }

            // Ë®≠ÂÆöÊé®Ê∏¨„ÇíË®àÁÆó
            const machineType = elements.machineType.value;
            const machine = machineData[machineType];
            const probabilities = calculateProbabilities(machine, actualBonusRate, actualBigRate, actualRegRate, actualGrapeRate, totalGames);

            // „Ç∞„É©„Éï„ÇíË°®Á§∫
            displaySettingGraph(probabilities);

            // ÁµêÊûú„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
            elements.resultSection.style.display = 'block';
            elements.resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ÂêÑË®≠ÂÆö„ÅÆÂèØËÉΩÊÄß„ÇíË®àÁÆóÔºàÁ∞°ÊòìÁâà„Éô„Ç§„Ç∫Êé®ÂÆöÔºâ
        function calculateProbabilities(machine, actualBonus, actualBig, actualReg, actualGrape, totalGames) {
            const probabilities = {};
            let totalScore = 0;

            for (let setting = 1; setting <= 6; setting++) {
                const settingData = machine.settings[setting];
                const expectedBonus = 1 / settingData.bonus;
                const expectedBig = 1 / settingData.big;
                const expectedReg = 1 / settingData.reg;
                const expectedGrape = actualGrape ? 1 / settingData.grape : null;

                // „Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàÂÆüÊ∏¨ÂÄ§„Å®ÁêÜË´ñÂÄ§„ÅÆÂ∑Æ„ÅåÂ∞è„Åï„ÅÑ„Åª„Å©È´ò„Çπ„Ç≥„Ç¢Ôºâ
                let score = 1000;

                // „Éú„Éº„Éä„ÇπÂêàÁÆó„ÅÆÈáç„Åø‰ªò„ÅëÔºàÊúÄÈáçË¶ÅÔºâ
                const bonusDiff = Math.abs(actualBonus - expectedBonus) / expectedBonus;
                score -= bonusDiff * 500;

                // BIGÁ¢∫Áéá„ÅÆÈáç„Åø‰ªò„Åë
                const bigDiff = Math.abs(actualBig - expectedBig) / expectedBig;
                score -= bigDiff * 300;

                // REGÁ¢∫Áéá„ÅÆÈáç„Åø‰ªò„Åë
                const regDiff = Math.abs(actualReg - expectedReg) / expectedReg;
                score -= regDiff * 300;

                // „Å∂„Å©„ÅÜÁ¢∫Áéá„ÅÆÈáç„Åø‰ªò„ÅëÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
                if (expectedGrape && actualGrape) {
                    const grapeDiff = Math.abs(actualGrape - expectedGrape) / expectedGrape;
                    score -= grapeDiff * 200;
                }

                // Ë©¶Ë°åÂõûÊï∞„Å´„Çà„Çã‰ø°È†ºÂ∫¶Ë£úÊ≠£
                const reliability = Math.min(totalGames / 3000, 1.0);
                score = score * reliability + (1 - reliability) * 500;

                score = Math.max(score, 0);
                probabilities[setting] = score;
                totalScore += score;
            }

            // Ê≠£Ë¶èÂåñ„Åó„Å¶„Éë„Éº„Çª„É≥„ÉÜ„Éº„Ç∏„Å´
            for (let setting = 1; setting <= 6; setting++) {
                probabilities[setting] = (probabilities[setting] / totalScore) * 100;
            }

            return probabilities;
        }

        // Ë®≠ÂÆö„Ç∞„É©„Éï„ÇíË°®Á§∫
        function displaySettingGraph(probabilities) {
            elements.settingGraph.innerHTML = '';

            let maxSetting = 1;
            let maxProb = 0;

            for (let setting = 1; setting <= 6; setting++) {
                const prob = probabilities[setting];

                if (prob > maxProb) {
                    maxProb = prob;
                    maxSetting = setting;
                }

                const barDiv = document.createElement('div');
                barDiv.className = 'setting-bar';

                const label = document.createElement('div');
                label.className = 'setting-label';
                label.textContent = `Ë®≠ÂÆö${setting}`;

                const container = document.createElement('div');
                container.className = 'bar-container';

                const fill = document.createElement('div');
                fill.className = 'bar-fill';
                fill.style.width = `${prob}%`;

                const percentage = document.createElement('span');
                percentage.className = 'bar-percentage';
                percentage.textContent = `${prob.toFixed(1)}%`;

                fill.appendChild(percentage);
                container.appendChild(fill);
                barDiv.appendChild(label);
                barDiv.appendChild(container);
                elements.settingGraph.appendChild(barDiv);
            }

            // Êé®Â•®Ë®≠ÂÆö„ÇíË°®Á§∫
            elements.recommendedSetting.textContent = `Ë®≠ÂÆö${maxSetting}Ôºà${maxProb.toFixed(1)}%Ôºâ`;
        }

        // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
        function resetForm() {
            elements.totalGames.value = '';
            elements.bigCount.value = '';
            elements.regCount.value = '';
            elements.grapeCount.value = '';
            elements.cherryCount.value = '';
            elements.resultSection.style.display = 'none';
        }

        // Â±•Ê≠¥„Å´‰øùÂ≠ò
        function saveToHistory() {
            const totalGames = parseInt(elements.totalGames.value) || 0;
            const bigCount = parseInt(elements.bigCount.value) || 0;
            const regCount = parseInt(elements.regCount.value) || 0;

            if (totalGames === 0 || (bigCount === 0 && regCount === 0)) {
                alert('„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åã„Çâ‰øùÂ≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const machineType = elements.machineType.value;
            const machineName = machineData[machineType].name;

            const historyItem = {
                id: Date.now(),
                date: new Date().toLocaleString('ja-JP'),
                machine: machineName,
                totalGames,
                bigCount,
                regCount,
                bonusRate: (totalGames / (bigCount + regCount)).toFixed(1),
                recommendedSetting: elements.recommendedSetting.textContent
            };

            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÊó¢Â≠ò„ÅÆÂ±•Ê≠¥„ÇíÂèñÂæó
            let history = JSON.parse(localStorage.getItem('jugglerHistory') || '[]');
            history.unshift(historyItem);

            // ÊúÄÊñ∞10‰ª∂„ÅÆ„Åø‰øùÊåÅ
            history = history.slice(0, 10);

            localStorage.setItem('jugglerHistory', JSON.stringify(history));
            loadHistory();

            alert('„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        }

        // Â±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('jugglerHistory') || '[]');
            elements.historyList.innerHTML = '';

            if (history.length === 0) {
                elements.historyList.innerHTML = '<p style="color: #6c757d; text-align: center; padding: 20px;">‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            history.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'history-item';

                itemDiv.innerHTML = `
                    <div class="history-item-header">
                        <span class="history-date">${item.date}</span>
                        <span class="history-delete" onclick="deleteHistory(${item.id})">ÂâäÈô§</span>
                    </div>
                    <div class="history-data">
                        <strong>${item.machine}</strong><br>
                        Á∑èÂõûËª¢: ${item.totalGames}G | BIG: ${item.bigCount} | REG: ${item.regCount}<br>
                        ÂêàÁÆó: 1/${item.bonusRate} | ${item.recommendedSetting}
                    </div>
                `;

                elements.historyList.appendChild(itemDiv);
            });
        }

        // Â±•Ê≠¥„ÇíÂâäÈô§
        function deleteHistory(id) {
            let history = JSON.parse(localStorage.getItem('jugglerHistory') || '[]');
            history = history.filter(item => item.id !== id);
            localStorage.setItem('jugglerHistory', JSON.stringify(history));
            loadHistory();
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ
        window.addEventListener('load', () => {
            // ÁîªÈù¢„ÅÆÂêë„Åç„Çí„É≠„ÉÉ„ÇØÔºàÁ∏¶Âêë„ÅçÊé®Â•®Ôºâ
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('portrait').catch(() => {
                    // „Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ
                });
            }
        });
    </script>
</body>
</html>
